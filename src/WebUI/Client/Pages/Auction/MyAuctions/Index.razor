@using System;
@using System.Text.RegularExpressions;

@page "/auctions" 
@attribute [Authorize(Permissions.Auction)]

<PageTitle>My Auctions</PageTitle>

<h3>Auctions you started</h3>

@if (Model == null) return;

<div class="row">
	<div class="col-sm-2">
		<a href="@($"auctions/new")" class="btn btn-success table-btn" data-toggle="tooltip" data-placement="bottom" title="Add">
			<i class="oi oi-book"></i> Add new
		</a>
	</div>
</div>

<div class="row filter-div d-flex align-items-end">
	<h5>Filter</h5>
	<div class="form-group col-sm-3">
		<label for="filter-category" class="col-sm-3">Category</label>
		<select class="auction-select" @bind="@Filter.Category">
			@foreach (var category in Categories)
			{
				<option value="@category">@Regex.Replace(category.ToString(), "(\\B[A-Z])", " $1")</option>
			}
		</select>
	</div>

	<div class="form-group col-sm-3">
		<label for="filter-status" class="col-sm-3">Status</label>
		<select class="auction-select" @bind="@Filter.Status">
			@foreach (var status in Statuses)
			{
				<option value="@status">@Regex.Replace(status.ToString(), "(\\B[A-Z])", " $1")</option>
			}
		</select>
	</div>

	<div class="col-sm-2 align-items-end">
		<a class="btn btn-secondary table-btn" @onclick="@(() => FilterAuctions())" data-toggle="tooltip" data-placement="bottom" title="Filter">
			<i class="oi oi-magnifying-glass"></i>
		</a>
	</div>
</div>

<table class="table table-striped table-hover">
	<thead>
		<tr style="text-align: center;">
			<th class="sort-header" @onclick="@(() => SortAuctions("Title"))" style="cursor: pointer;">
				@if (Sorter.ByTitle == "asc")
				{
					<i class="fas fa-angle-up"></i>
				}
				else
				{
					<i class="fas fa-angle-down"></i>
				}
				Title
			</th>

			<th class="sort-header" @onclick="@(() => SortAuctions("Category"))">
				@if (Sorter.ByCategory == "asc")
				{
					<i class="fas fa-angle-up"></i>
				}
				else
				{
					<i class="fas fa-angle-down"></i>
				}
				 Category
			</th>

			<th class="sort-header" @onclick="@(() => SortAuctions("Start Date"))">
				@if (Sorter.ByStartDate == "asc")
				{
					<i class="fas fa-angle-up"></i>
				}
				else
				{
					<i class="fas fa-angle-down"></i>
				}
				Opening time
			</th>

			<th class="sort-header" @onclick="@(() => SortAuctions("End Date"))">
				@if (Sorter.ByEndDate == "asc")
				{
					<i class="fas fa-angle-up"></i>
				}
				else
				{
					<i class="fas fa-angle-down"></i>
				}
				Closing time
			</th>

			<th>
				Starting Bid
			</th>

			<th>
				Current Bid
			</th>	

			<th>
				Auction status
			</th>

			<th>
				Actions
			</th>
		</tr>
	</thead>
	<tbody>
		@foreach (var item in Model.Auctions)
		{
			@if (FilteredAuctions != null && !FilteredAuctions.Contains(item))
			{
				continue;
			}

			<tr style="text-align: center;">
				<td><img src="@item.Images.FirstOrDefault()" alt="@item.Title" style="max-height:100px; max-width:100px; object-fit:contain;" /></td>
                <td><a href="@($"auctions/{item.Id.ToString()}/view")" data-toggle="tooltip" data-placement="bottom">@item.Title</a></td>
				<td>@item.Category</td>
				<td>@item.StartDate.ToString("dd/MM/yyyy HH:mm")</td>
				<td>@item.EndDate.ToString("dd/MM/yyyy HH:mm")</td>
				<td>@item.StartingBidAmount</td>
				<td>
					@if (@item.CurrentBidAmount == 0)
					{
						<i>-</i>
					}
					else
					{
						@item.CurrentBidAmount.ToString();
					}
				</td>
				<td>
					@if (@item.EndDate > DateTime.Now)
					{
						<p style="color: green">ACTIVE</p>
					}
					else
					{
						<p style="color: red">CLOSED</p>
					}
				</td>
				<td>
					<a href="@($"auctions/{item.Id.ToString()}")" class="btn btn-warning table-btn" @onclick="@(() => ShowWarnings(item, "edit"))" data-toggle="tooltip" data-placement="bottom" title="Edit">
						Edit
                    </a>
					<a href="@($"auctions")" class="btn btn-danger table-btn" @onclick="@(() => DeleteItem(item))" data-toggle="tooltip" data-placement="bottom" title="Delete">
                        Delete
                    </a>
				</td>
			</tr>
		}
	</tbody>
</table>

<ConfirmationDialog Title="Confirm delete"
					CloseEventCallback="@OnConfirmationDeleteDialogClosed"
					@ref="@ConfirmationDeleteDialog"></ConfirmationDialog>