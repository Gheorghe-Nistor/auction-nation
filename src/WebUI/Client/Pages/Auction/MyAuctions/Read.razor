@using System;
@using System.Text.RegularExpressions;

@page "/auctions/{auctionId}/view"
@attribute [Authorize(Permissions.Auction)]

<PageTitle>View Auction </PageTitle>

@if (Model == null)
{
    return;
}

<h1 class="mb-4">@Model.Auction.Title</h1>
@if (Model.Auction.Images.Count == 1)
{
    <img src="@Model.Auction.Images[0]" style="height: 600px; width: 800px; object-fit: contain" />
}
else
{
<Carousel @bind-SelectedSlide="@selectedSlide">
    @for (int i = 0; i < Model.Auction.Images.Count; i++)
    {
        if (i < Model.Auction.Images.Count)
        {
            var image = Model.Auction.Images[i];
            if (image != null)
            {
                <CarouselSlide Name=@($"{i + 1}")>
                    <img src="@image" style="height: 600px; width: 800px; object-fit: contain" />
                </CarouselSlide>
            }
        }
    }
</Carousel>
}

<div class="row" style="margin-left: -10px;">
    <div class="col-md-8" style="margin-left: 10px;">
       
        

        <h3>Description</h3>
        @if (Model.Auction.Description.Split(" ").Length <= 170)
        {
            <p>@Model.Auction.Description</p>
        }
        else
        {
            <div class="row">
                <div class="col-12">
                    <p style="text-indent: 30px;">
                        @foreach (var word in Model.Auction.Description.Split(" "))
                        {
                            <span>@word </span>
                            if (word.EndsWith(".") || word.EndsWith(",") || word.EndsWith("?"))
                            {
                                <br />
                            }
                        }
                    </p>
                </div>
            </div>
        }

        <h3>Details</h3>
        <table class="table">
            <tbody>
                <tr>
                    <td><strong>Category:</strong></td>
                    <td>@Model.Auction.Category</td>
                </tr>
                <tr>
                    <td><strong>Starting Bid Amount:</strong></td>
                    <td>@Model.Auction.StartingBidAmount</td>
                </tr>
                <tr>
                    <td><strong>Current Bid Amount:</strong></td>
                    <td>@Model.Auction.CurrentBidAmount</td>
                </tr>
                <tr>
                    <td><strong>Buy It Now Price:</strong></td>
                    <td>@Model.Auction.BuyItNowPrice</td>
                </tr>
                <tr>
                    <td><strong>Reserve Price:</strong></td>
                    <td>@Model.Auction.ReservePrice</td>
                </tr>
                <tr>
                    <td><strong>Start Date:</strong></td>
                    <td>@Model.Auction.StartDate.ToShortDateString()</td>
                </tr>
                <tr>
                    <td><strong>End Date:</strong></td>
                    <td>@Model.Auction.EndDate.ToShortDateString()</td>
                </tr>
                <tr>
                    <td><strong>Delivery Method:</strong></td>
                    <td>@Model.Auction.DeliveryMethod</td>
                </tr>
            </tbody>
        </table>

        <h3>Time Left</h3>
		@if (TimeLeft.Days < 0 || TimeLeft.Hours < 0 || TimeLeft.Minutes < 0 || TimeLeft.Seconds < 0)
		{
			<p>Auction is closed!</p>
		}
		else
		{
			<p>@TimeLeft.Days days, @TimeLeft.Hours hours, @TimeLeft.Minutes minutes, @TimeLeft.Seconds seconds</p>
		}

        <h3>Bidding History</h3>
        <ul>
            @foreach (var bid in Model.Auction.BiddingHistory)
            {
                <li>@bid.UserId - @bid.Amount</li>
            }
        </ul>
    </div>
</div>

<div class="row">
	<a href="/auctions">Take me back</a>
</div>







